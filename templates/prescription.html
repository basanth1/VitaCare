{% extends "base.html" %}
{% block content %}
<section class="container">
  <h2 class="text-center text-primary my-4">Upload Your Prescription</h2>
  <p class="text-center">AI will extract key details and medications.</p>

  <form method="POST" enctype="multipart/form-data" class="my-4 text-center">
    <input type="file" name="prescription" class="form-control w-50 mx-auto" accept=".png,.jpg,.jpeg" required>
    <br>
    <button type="submit" class="btn btn-primary">Upload & Analyze</button>
  </form>

  {% if result %}
    <h3 class="my-4">ðŸ“‹ Extracted Details</h3>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead><tr><th>Field</th><th>Value</th></tr></thead>
        <tbody>
          {% for key, value in result.items() if key != 'medications' %}
            <tr>
              <td>{{ key.replace("_", " ").capitalize() }}</td>
              <td>{{ value if value else "Text can't be extracted because the image is not clear" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <h3 class="my-4">ðŸ’Š Medications</h3>
    <div class="table-responsive">
      <table class="table table-bordered">
        <thead><tr><th>Name</th><th>Dosage</th><th>Frequency</th><th>Duration</th></tr></thead>
        <tbody>
          {% for med in result.medications %}
          <tr>
            <td>{{ med.name if med.name else "Text can't be extracted because the image is not clear" }}</td>
            <td>{{ med.dosage if med.dosage else "Text can't be extracted because the image is not clear" }}</td>
            <td>{{ med.frequency if med.frequency else "Text can't be extracted because the image is not clear" }}</td>
            <td>{{ med.duration if med.duration else "Text can't be extracted because the image is not clear" }}</td>
          </tr>
          {% endfor %}
          {% if result.medications|length == 0 %}
            <tr><td colspan="4" class="text-center text-muted">Image is not clear</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  {% endif %}
</section>
{% endblock %}
