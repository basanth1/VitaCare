{% extends "base.html" %}
{% block content %}
<section class="container">
  <h2 class="text-center text-primary my-4">üõí Order Medicines</h2>
  <form method="GET" class="input-group mb-3">
    <input type="text" name="search" class="form-control" placeholder="Search Medicine..." value="{{ request.args.get('search', '') }}">
    <button class="btn btn-primary" type="submit">Search</button>
    <a href="{{ url_for('clear_cart') }}" class="btn btn-outline-secondary">Clear Cart</a>
  </form>

  <div class="row">
    <!-- Medicine List -->
    <div class="col-md-8">
      {% if medicines %}
        {% for med in medicines %}
          <div class="card mb-3">
            <div class="row g-0">
              <div class="col-md-2">
                <img src="{{ med['Image URL'] }}" class="img-fluid rounded-start" alt="medicine">
              </div>
              <div class="col-md-10">
                <div class="card-body">
                  <h5 class="card-title">{{ med['Medicine Name'] }}</h5>
                  <p class="card-text">üí∏ ‚Çπ{{ med['Price'] }} | üè≠ {{ med['Manufacturer'] }}</p>
                  <p class="card-text">üß™ {{ med['Composition'] }}</p>
                  <form method="POST" action="{{ url_for('add_to_cart') }}">
                    <input type="hidden" name="name" value="{{ med['Medicine Name'] }}">
                    <input type="hidden" name="price" value="{{ med['Price'] }}">
                    <input type="hidden" name="image" value="{{ med['Image URL'] }}">
                    <button type="submit" class="btn btn-success">Add to Cart</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>No medicines found.</p>
      {% endif %}
    </div>

    <!-- Cart Sidebar -->
    <div class="col-md-4">
      <div class="bg-light p-3 rounded">
        <h4>Your Cart</h4>
        {% if cart %}
            {% set ns = namespace(total=0) %}
            {% for name, item in cart.items() %}
            <div class="mb-3">
                <img src="{{ item['image'] }}" width="60">
                <p><strong>{{ name }}</strong></p>
                <p>‚Çπ{{ item['price'] }} √ó {{ item['qty'] }}</p>
                <form method="POST" action="{{ url_for('update_cart') }}" class="d-flex gap-2">
                <input type="hidden" name="name" value="{{ name }}">
                <button name="action" value="minus" class="btn btn-sm btn-outline-secondary">-</button>
                <button name="action" value="plus" class="btn btn-sm btn-outline-secondary">+</button>
                </form>
                {% set ns.total = ns.total + (item['qty'] * item['price']) %}
            </div>
            {% endfor %}
            <hr>
            <h5>Total: ‚Çπ{{ ns.total }}</h5>

          <form method="POST" action="{{ url_for('checkout') }}">
            <div class="mb-2">
              <input type="text" name="name" class="form-control" placeholder="Full Name" required>
            </div>
            <div class="mb-2">
              <textarea name="address" class="form-control" placeholder="Delivery Address" required></textarea>
            </div>
            <div class="mb-2">
              <input type="text" name="card" class="form-control" placeholder="Card Number" maxlength="16" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Pay Now</button>
          </form>
        {% else %}
          <p>Cart is empty.</p>
        {% endif %}
        {% if success %}<div class="text-success fw-bold">{{ success }}</div>{% endif %}
        {% if error %}<div class="text-danger fw-bold">{{ error }}</div>{% endif %}
      </div>
    </div>
  </div>
</section>
{% endblock %}
